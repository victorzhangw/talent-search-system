# LLM æœç´¢æµç¨‹è©³è§£

## å®Œæ•´æµç¨‹åœ–

```
ç”¨æˆ¶è¼¸å…¥
   â†“
"æˆ‘éœ€è¦ä¸€å€‹å–„æ–¼æºé€šçš„éŠ·å”®äººå“¡"
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 1: å‰ç«¯ç™¼é€è«‹æ±‚                                          â”‚
â”‚ POST /api/search                                             â”‚
â”‚ { "query": "æˆ‘éœ€è¦ä¸€å€‹å–„æ–¼æºé€šçš„éŠ·å”®äººå“¡" }                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 2: å¾Œç«¯æ¥æ”¶ä¸¦èª¿ç”¨ LLM è§£æ                               â”‚
â”‚                                                              â”‚
â”‚ TalentSearchEngine.parse_query()                            â”‚
â”‚   â†“                                                          â”‚
â”‚ LLMService.analyze_query()                                  â”‚
â”‚   â†“                                                          â”‚
â”‚ ç™¼é€åˆ° DeepSeek API:                                         â”‚
â”‚ {                                                            â”‚
â”‚   "messages": [                                              â”‚
â”‚     {                                                        â”‚
â”‚       "role": "system",                                      â”‚
â”‚       "content": "ä½ æ˜¯äººæ‰æœç´¢åŠ©æ‰‹..."                        â”‚
â”‚     },                                                       â”‚
â”‚     {                                                        â”‚
â”‚       "role": "user",                                        â”‚
â”‚       "content": "è«‹åˆ†æï¼šæˆ‘éœ€è¦ä¸€å€‹å–„æ–¼æºé€šçš„éŠ·å”®äººå“¡"        â”‚
â”‚     }                                                        â”‚
â”‚   ]                                                          â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 3: LLM è¿”å›çµæ§‹åŒ–åˆ†æ                                    â”‚
â”‚                                                              â”‚
â”‚ {                                                            â”‚
â”‚   "traits": ["æºé€šèƒ½åŠ›", "èªªæœåŠ›"],                          â”‚
â”‚   "role": "éŠ·å”®äººå“¡",                                         â”‚
â”‚   "keywords": ["æºé€š", "éŠ·å”®", "å®¢æˆ¶"],                       â”‚
â”‚   "requirements": {                                          â”‚
â”‚     "personality": ["å¤–å‘", "è¦ªå’ŒåŠ›"],                        â”‚
â”‚     "skills": ["å®¢æˆ¶é—œä¿‚ç®¡ç†"]                                â”‚
â”‚   },                                                         â”‚
â”‚   "summary": "å°‹æ‰¾å…·å‚™å„ªç§€æºé€šèƒ½åŠ›çš„éŠ·å”®äººå“¡"                  â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 4: ä½¿ç”¨ LLM åˆ†æçµæœæŸ¥è©¢è³‡æ–™åº«                           â”‚
â”‚                                                              â”‚
â”‚ TalentSearchEngine.search_candidates()                      â”‚
â”‚   â†“                                                          â”‚
â”‚ SQL æŸ¥è©¢:                                                    â”‚
â”‚ SELECT                                                       â”‚
â”‚   ip.id, ip.name, ip.email,                                 â”‚
â”‚   json_agg(itr.*) as test_results                           â”‚
â”‚ FROM individual_profile ip                                  â”‚
â”‚ LEFT JOIN individual_test_result itr                        â”‚
â”‚   ON ip.id = itr.individual_id                              â”‚
â”‚ WHERE ip.name IS NOT NULL                                   â”‚
â”‚ GROUP BY ip.id                                              â”‚
â”‚ LIMIT 50;                                                   â”‚
â”‚                                                              â”‚
â”‚ è¿”å›å€™é¸äººåˆ—è¡¨ (50äºº)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 5: è¨ˆç®—æ¯å€‹å€™é¸äººçš„åŒ¹é…åˆ†æ•¸                              â”‚
â”‚                                                              â”‚
â”‚ for candidate in candidates:                                â”‚
â”‚   score = calculate_match_score(candidate, llm_analysis)   â”‚
â”‚                                                              â”‚
â”‚ åŒ¹é…é‚è¼¯:                                                    â”‚
â”‚ â€¢ åŸºç¤åˆ†æ•¸: 0.5                                              â”‚
â”‚ â€¢ æœ‰æ¸¬è©•çµæœ: +0.3                                           â”‚
â”‚ â€¢ ç‰¹è³ªåŒ¹é…: +0.2                                             â”‚
â”‚                                                              â”‚
â”‚ å€™é¸äºº A: 0.8 (80%)                                          â”‚
â”‚ å€™é¸äºº B: 0.7 (70%)                                          â”‚
â”‚ å€™é¸äºº C: 0.6 (60%)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 6: ç‚ºæ¯å€‹å€™é¸äººç”Ÿæˆæ¨è–¦ç†ç”± (å†æ¬¡èª¿ç”¨ LLM)               â”‚
â”‚                                                              â”‚
â”‚ for candidate in top_candidates:                            â”‚
â”‚   reason = LLMService.generate_match_reason(               â”‚
â”‚     candidate, query, score                                 â”‚
â”‚   )                                                          â”‚
â”‚                                                              â”‚
â”‚ ç™¼é€åˆ° DeepSeek API:                                         â”‚
â”‚ "ç”¨æˆ¶éœ€æ±‚ï¼šæˆ‘éœ€è¦ä¸€å€‹å–„æ–¼æºé€šçš„éŠ·å”®äººå“¡                       â”‚
â”‚  å€™é¸äººï¼šç‹å°æ˜                                               â”‚
â”‚  å·²å®Œæˆ 3 é …æ¸¬è©•                                              â”‚
â”‚  åŒ¹é…åº¦ï¼š80%                                                  â”‚
â”‚  è«‹ç”Ÿæˆæ¨è–¦ç†ç”±..."                                           â”‚
â”‚                                                              â”‚
â”‚ LLM è¿”å›:                                                    â”‚
â”‚ "ç‹å°æ˜åœ¨æºé€šèƒ½åŠ›æ–¹é¢è¡¨ç¾å„ªç•°ï¼Œå·²å®Œæˆ3é …æ¸¬è©•ï¼Œ               â”‚
â”‚  å…·å‚™è±å¯Œçš„éŠ·å”®ç¶“é©—ï¼Œé«˜åº¦ç¬¦åˆæ‚¨çš„éœ€æ±‚"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 7: æ’åºä¸¦è¿”å›çµæœ                                        â”‚
â”‚                                                              â”‚
â”‚ candidates.sort(by match_score, descending)                 â”‚
â”‚                                                              â”‚
â”‚ è¿”å›å‰ 10 å:                                                 â”‚
â”‚ [                                                            â”‚
â”‚   {                                                          â”‚
â”‚     "id": 1,                                                 â”‚
â”‚     "name": "ç‹å°æ˜",                                         â”‚
â”‚     "email": "wang@example.com",                            â”‚
â”‚     "match_score": 0.8,                                     â”‚
â”‚     "match_reason": "ç‹å°æ˜åœ¨æºé€šèƒ½åŠ›æ–¹é¢..."                 â”‚
â”‚   },                                                         â”‚
â”‚   ...                                                        â”‚
â”‚ ]                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 8: å‰ç«¯é¡¯ç¤ºçµæœ                                          â”‚
â”‚                                                              â”‚
â”‚ â€¢ é¡¯ç¤ºæŸ¥è©¢ç†è§£ï¼š"å°‹æ‰¾å…·å‚™å„ªç§€æºé€šèƒ½åŠ›çš„éŠ·å”®äººå“¡"              â”‚
â”‚ â€¢ é¡¯ç¤ºå€™é¸äººå¡ç‰‡                                              â”‚
â”‚ â€¢ é¡¯ç¤ºåŒ¹é…åº¦å’Œæ¨è–¦ç†ç”±                                        â”‚
â”‚ â€¢ æä¾›æœç´¢å»ºè­°                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä»£ç¢¼æµç¨‹è©³è§£

### 1. å‰ç«¯ç™¼é€è«‹æ±‚

**æ–‡ä»¶**: `talent-chat-frontend.html`

```javascript
async sendMessage() {
    const query = this.userInput;

    // èª¿ç”¨å¾Œç«¯ API
    const response = await axios.post('http://localhost:8000/api/search', {
        query: query,
        filters: null
    });

    // é¡¯ç¤ºçµæœ
    this.candidates = response.data.candidates;
}
```

### 2. å¾Œç«¯æ¥æ”¶è«‹æ±‚

**æ–‡ä»¶**: `BackEnd/talent_search_api.py`

```python
@app.post("/api/search", response_model=SearchResponse)
async def search_talents(query: SearchQuery):
    """æœç´¢äººæ‰ - ä½¿ç”¨ LLM å¢å¼·"""
    engine = TalentSearchEngine()

    # æ­¥é©Ÿ 2.1: ä½¿ç”¨ LLM è§£ææŸ¥è©¢
    parsed_query = await engine.parse_query(query.query)

    # æ­¥é©Ÿ 2.2: æŸ¥è©¢è³‡æ–™åº«
    raw_candidates = engine.search_candidates(query.query, query.filters)

    # æ­¥é©Ÿ 2.3: è¨ˆç®—åŒ¹é…åˆ†æ•¸å’Œç”Ÿæˆç†ç”±
    candidates = []
    for candidate in raw_candidates[:20]:
        score = engine.calculate_match_score(candidate, parsed_query)
        reason = await engine.generate_match_reason(
            candidate, query.query, score, parsed_query
        )

        candidates.append(Candidate(
            id=candidate['id'],
            name=candidate['name'],
            email=candidate['email'],
            match_score=score,
            match_reason=reason
        ))

    # æ­¥é©Ÿ 2.4: æ’åºä¸¦è¿”å›
    candidates.sort(key=lambda x: x.match_score, reverse=True)
    return SearchResponse(
        candidates=candidates[:10],
        total=len(candidates),
        query_understanding=parsed_query.get('summary', ''),
        suggestions=[...]
    )
```

### 3. LLM è§£ææŸ¥è©¢

**æ–‡ä»¶**: `BackEnd/talent_search_api.py`

```python
class TalentSearchEngine:
    async def parse_query(self, query: str) -> Dict[str, Any]:
        """ä½¿ç”¨ LLM è§£ææŸ¥è©¢"""
        # èª¿ç”¨ LLM æœå‹™
        llm_result = await self.llm_service.analyze_query(query)

        if llm_result['success']:
            # LLM æˆåŠŸï¼Œè¿”å›çµæ§‹åŒ–åˆ†æ
            return llm_result['analysis']
            # ä¾‹å¦‚:
            # {
            #   "traits": ["æºé€šèƒ½åŠ›", "èªªæœåŠ›"],
            #   "role": "éŠ·å”®äººå“¡",
            #   "keywords": ["æºé€š", "éŠ·å”®"],
            #   "summary": "å°‹æ‰¾å…·å‚™å„ªç§€æºé€šèƒ½åŠ›çš„éŠ·å”®äººå“¡"
            # }
        else:
            # LLM å¤±æ•—ï¼Œé™ç´šåˆ°é—œéµå­—åŒ¹é…
            return self._parse_query_simple(query)
```

### 4. LLM æœå‹™èª¿ç”¨

**æ–‡ä»¶**: `BackEnd/talent_search_api.py`

```python
class LLMService:
    async def analyze_query(self, query: str) -> Dict[str, Any]:
        """èª¿ç”¨ DeepSeek API åˆ†ææŸ¥è©¢"""
        try:
            async with httpx.AsyncClient(timeout=30.0) as client:
                # ç™¼é€è«‹æ±‚åˆ° DeepSeek API
                response = await client.post(
                    'https://api.siliconflow.cn/v1/chat/completions',
                    headers={
                        'Authorization': f'Bearer {self.api_key}'
                    },
                    json={
                        'model': 'deepseek-ai/DeepSeek-V3',
                        'messages': [
                            {
                                'role': 'system',
                                'content': self.get_system_prompt()
                                # åŒ…å«å¦‚ä½•åˆ†æäººæ‰éœ€æ±‚çš„æŒ‡ç¤º
                            },
                            {
                                'role': 'user',
                                'content': f'è«‹åˆ†æä»¥ä¸‹äººæ‰éœ€æ±‚ï¼š\n\n{query}'
                            }
                        ],
                        'temperature': 0.3,
                        'response_format': {'type': 'json_object'}
                    }
                )

                # è§£æ LLM å›æ‡‰
                data = response.json()
                content = data['choices'][0]['message']['content']
                analysis = json.loads(content)

                return {
                    'success': True,
                    'analysis': analysis
                }
        except Exception as e:
            return {
                'success': False,
                'error': str(e)
            }
```

### 5. è³‡æ–™åº«æŸ¥è©¢

**æ–‡ä»¶**: `BackEnd/talent_search_api.py`

```python
class TalentSearchEngine:
    def search_candidates(self, query: str, filters: Optional[Dict] = None):
        """æŸ¥è©¢è³‡æ–™åº«ç²å–å€™é¸äºº"""
        cursor = self.conn.cursor()

        # SQL æŸ¥è©¢ - ç²å–æ‰€æœ‰å€™é¸äººåŠå…¶æ¸¬è©•çµæœ
        sql = """
            SELECT
                ip.id,
                ip.name,
                ip.email,
                ip.phone,
                ip.created_at,
                json_agg(
                    json_build_object(
                        'test_id', itr.id,
                        'test_date', itr.test_date,
                        'result', itr.result_data
                    )
                ) as test_results
            FROM individual_profile ip
            LEFT JOIN individual_test_result itr
                ON ip.id = itr.individual_id
            WHERE ip.name IS NOT NULL
            GROUP BY ip.id, ip.name, ip.email, ip.phone, ip.created_at
            LIMIT 50;
        """

        cursor.execute(sql)
        results = cursor.fetchall()

        # è½‰æ›ç‚ºå­—å…¸æ ¼å¼
        candidates = []
        for row in results:
            candidate = {
                'id': row[0],
                'name': row[1],
                'email': row[2],
                'phone': row[3],
                'created_at': row[4],
                'test_results': row[5] if row[5] else []
            }
            candidates.append(candidate)

        return candidates
```

### 6. åŒ¹é…åˆ†æ•¸è¨ˆç®—

**æ–‡ä»¶**: `BackEnd/talent_search_api.py`

```python
class TalentSearchEngine:
    def calculate_match_score(self, candidate: Dict, parsed_query: Dict) -> float:
        """è¨ˆç®—å€™é¸äººèˆ‡éœ€æ±‚çš„åŒ¹é…åˆ†æ•¸"""
        score = 0.5  # åŸºç¤åˆ†æ•¸

        # å› ç´  1: æ˜¯å¦æœ‰æ¸¬è©•çµæœ
        if candidate.get('test_results'):
            test_count = len([t for t in candidate['test_results'] if t])
            if test_count > 0:
                score += 0.3  # æœ‰æ¸¬è©•çµæœåŠ åˆ†

        # å› ç´  2: ç‰¹è³ªåŒ¹é…
        if parsed_query.get('traits'):
            # å¦‚æœ LLM æå–äº†ç‰¹è³ªè¦æ±‚
            score += 0.2

        # ç¢ºä¿åˆ†æ•¸åœ¨ 0-1 ä¹‹é–“
        return min(score, 1.0)
```

### 7. LLM ç”Ÿæˆæ¨è–¦ç†ç”±

**æ–‡ä»¶**: `BackEnd/talent_search_api.py`

```python
class LLMService:
    async def generate_match_reason(self, candidate: Dict, query: str, score: float):
        """ä½¿ç”¨ LLM ç”Ÿæˆå€‹æ€§åŒ–æ¨è–¦ç†ç”±"""
        try:
            # æº–å‚™å€™é¸äººè³‡è¨Š
            test_info = ""
            if candidate.get('test_results'):
                test_count = len([t for t in candidate['test_results'] if t])
                test_info = f"å·²å®Œæˆ {test_count} é …æ¸¬è©•"

            # æ§‹å»º Prompt
            prompt = f"""ä½œç‚ºäººæ‰æ¨è–¦é¡§å•ï¼Œè«‹ç‚ºä»¥ä¸‹å€™é¸äººç”Ÿæˆç°¡çŸ­çš„æ¨è–¦ç†ç”±ã€‚

ç”¨æˆ¶éœ€æ±‚ï¼š{query}

å€™é¸äººè³‡è¨Šï¼š
- å§“åï¼š{candidate.get('name', 'æœªçŸ¥')}
- {test_info}
- åŒ¹é…åº¦ï¼š{score:.0f}%

è«‹ç”¨ä¸€å¥è©±ï¼ˆ30å­—å…§ï¼‰èªªæ˜ç‚ºä»€éº¼æ¨è–¦é€™ä½å€™é¸äººã€‚"""

            # èª¿ç”¨ LLM API
            async with httpx.AsyncClient(timeout=20.0) as client:
                response = await client.post(
                    self.api_endpoint,
                    headers={'Authorization': f'Bearer {self.api_key}'},
                    json={
                        'model': self.model,
                        'messages': [{'role': 'user', 'content': prompt}],
                        'temperature': 0.7,
                        'max_tokens': 100
                    }
                )

                if response.status_code == 200:
                    data = response.json()
                    reason = data['choices'][0]['message']['content'].strip()
                    return reason
                else:
                    # é™ç´šåˆ°ç°¡å–®ç†ç”±
                    return self._generate_simple_reason(candidate, score, test_info)

        except Exception as e:
            # éŒ¯èª¤è™•ç† - é™ç´šåˆ°ç°¡å–®ç†ç”±
            return self._generate_simple_reason(candidate, score, test_info)
```

## é—œéµé»èªªæ˜

### 1. LLM çš„å…©æ¬¡èª¿ç”¨

ç³»çµ±æœƒèª¿ç”¨ LLM **å…©æ¬¡**ï¼š

**ç¬¬ä¸€æ¬¡**: è§£æç”¨æˆ¶æŸ¥è©¢

- è¼¸å…¥ï¼šç”¨æˆ¶çš„è‡ªç„¶èªè¨€éœ€æ±‚
- è¼¸å‡ºï¼šçµæ§‹åŒ–çš„æœç´¢åƒæ•¸ï¼ˆç‰¹è³ªã€è·ä½ã€æŠ€èƒ½ç­‰ï¼‰
- ç›®çš„ï¼šç†è§£ç”¨æˆ¶çœŸæ­£æƒ³è¦ä»€éº¼

**ç¬¬äºŒæ¬¡**: ç”Ÿæˆæ¨è–¦ç†ç”±

- è¼¸å…¥ï¼šå€™é¸äººè³‡è¨Š + ç”¨æˆ¶éœ€æ±‚ + åŒ¹é…åˆ†æ•¸
- è¼¸å‡ºï¼šå€‹æ€§åŒ–çš„æ¨è–¦ç†ç”±
- ç›®çš„ï¼šè§£é‡‹ç‚ºä»€éº¼æ¨è–¦é€™å€‹å€™é¸äºº

### 2. è³‡æ–™åº«æŸ¥è©¢ç­–ç•¥

ç›®å‰çš„å¯¦ä½œæ˜¯ï¼š

1. **å…ˆæŸ¥è©¢æ‰€æœ‰å€™é¸äºº**ï¼ˆLIMIT 50ï¼‰
2. **åœ¨è¨˜æ†¶é«”ä¸­è¨ˆç®—åŒ¹é…åˆ†æ•¸**
3. **æ’åºå¾Œè¿”å›å‰ 10 å**

é€™æ˜¯ç°¡åŒ–ç‰ˆæœ¬ã€‚å¯¦éš›æ‡‰ç”¨ä¸­å¯ä»¥ï¼š

- ä½¿ç”¨ LLM åˆ†æçµæœæ§‹å»ºæ›´ç²¾ç¢ºçš„ SQL WHERE æ¢ä»¶
- ä½¿ç”¨å‘é‡æœç´¢é€²è¡Œèªç¾©åŒ¹é…
- å»ºç«‹ç´¢å¼•åŠ é€ŸæŸ¥è©¢

### 3. é™ç´šæ©Ÿåˆ¶

å¦‚æœ LLM èª¿ç”¨å¤±æ•—ï¼š

- **æŸ¥è©¢è§£æé™ç´š** â†’ ä½¿ç”¨é—œéµå­—åŒ¹é…
- **ç†ç”±ç”Ÿæˆé™ç´š** â†’ ä½¿ç”¨æ¨¡æ¿åŒ–ç†ç”±

ç¢ºä¿ç³»çµ±å§‹çµ‚å¯ç”¨ï¼

## å¯¦éš›åŸ·è¡Œç¯„ä¾‹

### è¼¸å…¥

```
"æˆ‘éœ€è¦ä¸€å€‹å–„æ–¼æºé€šçš„éŠ·å”®äººå“¡"
```

### LLM ç¬¬ä¸€æ¬¡èª¿ç”¨ï¼ˆæŸ¥è©¢è§£æï¼‰

```json
{
  "traits": ["æºé€šèƒ½åŠ›", "èªªæœåŠ›"],
  "role": "éŠ·å”®äººå“¡",
  "keywords": ["æºé€š", "éŠ·å”®", "å®¢æˆ¶"],
  "summary": "å°‹æ‰¾å…·å‚™å„ªç§€æºé€šèƒ½åŠ›çš„éŠ·å”®äººå“¡"
}
```

### è³‡æ–™åº«æŸ¥è©¢çµæœ

```
æ‰¾åˆ° 50 ä½å€™é¸äºº
```

### åŒ¹é…åˆ†æ•¸è¨ˆç®—

```
ç‹å°æ˜: 0.8 (æœ‰æ¸¬è©• + ç‰¹è³ªåŒ¹é…)
æç¾è¯: 0.5 (åŸºç¤åˆ†æ•¸)
å¼µå¿—å¼·: 0.8 (æœ‰æ¸¬è©• + ç‰¹è³ªåŒ¹é…)
...
```

### LLM ç¬¬äºŒæ¬¡èª¿ç”¨ï¼ˆç‚ºç‹å°æ˜ç”Ÿæˆç†ç”±ï¼‰

```
è¼¸å…¥: "ç”¨æˆ¶éœ€æ±‚ï¼šæˆ‘éœ€è¦ä¸€å€‹å–„æ–¼æºé€šçš„éŠ·å”®äººå“¡
      å€™é¸äººï¼šç‹å°æ˜
      å·²å®Œæˆ 3 é …æ¸¬è©•
      åŒ¹é…åº¦ï¼š80%"

è¼¸å‡º: "ç‹å°æ˜åœ¨æºé€šèƒ½åŠ›æ–¹é¢è¡¨ç¾å„ªç•°ï¼Œå·²å®Œæˆ3é …æ¸¬è©•ï¼Œ
      å…·å‚™è±å¯Œçš„éŠ·å”®ç¶“é©—ï¼Œé«˜åº¦ç¬¦åˆæ‚¨çš„éœ€æ±‚"
```

### æœ€çµ‚è¿”å›

```json
{
  "candidates": [
    {
      "id": 1,
      "name": "ç‹å°æ˜",
      "match_score": 0.8,
      "match_reason": "ç‹å°æ˜åœ¨æºé€šèƒ½åŠ›æ–¹é¢è¡¨ç¾å„ªç•°..."
    },
    ...
  ],
  "query_understanding": "å°‹æ‰¾å…·å‚™å„ªç§€æºé€šèƒ½åŠ›çš„éŠ·å”®äººå“¡",
  "suggestions": ["å˜—è©¦æ·»åŠ æ›´å¤šå…·é«”è¦æ±‚"]
}
```

## ç¸½çµ

æ•´å€‹æµç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š

1. **LLM ç†è§£** â†’ å°‡è‡ªç„¶èªè¨€è½‰æ›ç‚ºçµæ§‹åŒ–åƒæ•¸
2. **è³‡æ–™åº«æŸ¥è©¢** â†’ ç²å–å€™é¸äººè³‡æ–™
3. **æ™ºèƒ½åŒ¹é…** â†’ è¨ˆç®—åŒ¹é…åˆ†æ•¸
4. **LLM è§£é‡‹** â†’ ç”Ÿæˆå€‹æ€§åŒ–æ¨è–¦ç†ç”±

é€™æ¨£å°±å¯¦ç¾äº†çœŸæ­£çš„ AI é©…å‹•äººæ‰æœç´¢ï¼ğŸ¯
