# 系統啟動流程

## 🚀 一鍵啟動流程

```
雙擊 start_all.bat
        ↓
┌───────────────────────────────────────────────────────────┐
│ [1/3] 檢查環境                                             │
│                                                            │
│ ✓ 檢查 BackEnd/venv 是否存在                               │
│ ✓ 檢查 Python 套件是否已安裝                               │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ [2/3] 啟動後端 API                                         │
│                                                            │
│ 開啟新視窗執行:                                             │
│ cd BackEnd                                                 │
│ venv\Scripts\activate                                      │
│ python talent_search_api.py                                │
│                                                            │
│ 後端啟動在: http://localhost:8000                          │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ 後端初始化流程                                              │
│                                                            │
│ 1. 建立 SSH 隧道到資料庫                                    │
│    ✓ 連接 61.216.152.8:22                                 │
│    ✓ 使用私鑰認證                                          │
│    ✓ 建立本地端口轉發                                       │
│                                                            │
│ 2. 連接 PostgreSQL 資料庫                                  │
│    ✓ 連接 localhost:<tunnel_port>                         │
│    ✓ 資料庫: projectdb                                     │
│                                                            │
│ 3. 載入資料庫特質                                           │
│    ✓ SELECT * FROM trait                                  │
│    ✓ 載入 50 個特質到記憶體                                 │
│                                                            │
│ 4. 初始化 LLM 服務                                         │
│    ✓ 配置 DeepSeek API                                    │
│    ✓ 準備 System Prompt                                   │
│                                                            │
│ 5. 啟動 FastAPI 服務                                       │
│    ✓ 註冊 API 端點                                         │
│    ✓ 啟用 CORS                                            │
│    ✓ 啟動 Uvicorn 伺服器                                   │
│                                                            │
│ ✅ Application startup complete                           │
└───────────────────────────────────────────────────────────┘
        ↓
        等待 5 秒
        ↓
┌───────────────────────────────────────────────────────────┐
│ [3/3] 啟動前端                                             │
│                                                            │
│ 在預設瀏覽器中開啟:                                         │
│ talent-chat-frontend.html                                  │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ 前端初始化流程                                              │
│                                                            │
│ 1. 載入 Vue.js 框架                                        │
│    ✓ 初始化 Vue 應用                                       │
│    ✓ 設定響應式數據                                        │
│                                                            │
│ 2. 檢查後端連接                                            │
│    ✓ GET http://localhost:8000/                           │
│    ✓ 顯示連接狀態                                          │
│                                                            │
│ 3. 顯示歡迎訊息                                            │
│    ✓ "您好！我是 AI 人才搜索助手..."                        │
│                                                            │
│ 4. 準備搜索建議                                            │
│    ✓ 顯示範例查詢                                          │
│                                                            │
│ ✅ 前端就緒，等待用戶輸入                                   │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ ✅ 系統啟動完成！                                          │
│                                                            │
│ 後端 API: http://localhost:8000                           │
│ API 文檔: http://localhost:8000/docs                      │
│ 前端介面: 已在瀏覽器中開啟                                  │
└───────────────────────────────────────────────────────────┘
```

## 🔄 用戶搜索流程

```
用戶在前端輸入查詢
        ↓
"我需要一個善於溝通的銷售人員"
        ↓
┌───────────────────────────────────────────────────────────┐
│ 前端處理                                                    │
│                                                            │
│ 1. 驗證輸入                                                │
│    ✓ 檢查是否為空                                          │
│                                                            │
│ 2. 顯示用戶訊息                                            │
│    ✓ 添加到聊天記錄                                        │
│    ✓ 顯示打字指示器                                        │
│                                                            │
│ 3. 調用後端 API                                            │
│    POST http://localhost:8000/api/search                  │
│    {                                                       │
│      "query": "我需要一個善於溝通的銷售人員",               │
│      "filters": null                                       │
│    }                                                       │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ 後端處理 - 步驟 1: LLM 解析查詢                            │
│                                                            │
│ TalentSearchEngine.parse_query()                          │
│   ↓                                                        │
│ LLMService.analyze_query()                                │
│   ↓                                                        │
│ 發送到 DeepSeek API:                                       │
│ {                                                          │
│   "model": "deepseek-ai/DeepSeek-V3",                     │
│   "messages": [                                            │
│     {                                                      │
│       "role": "system",                                    │
│       "content": "你是人才搜索助手。                        │
│                   資料庫中可用的特質：                      │
│                   - 協調溝通: 能有效理解他人需求...         │
│                   - 積極傾聽: 能專注聆聽他人發言...         │
│                   ..."                                     │
│     },                                                     │
│     {                                                      │
│       "role": "user",                                      │
│       "content": "請分析：我需要一個善於溝通的銷售人員"      │
│     }                                                      │
│   ]                                                        │
│ }                                                          │
│   ↓                                                        │
│ LLM 返回:                                                  │
│ {                                                          │
│   "matched_traits": [                                      │
│     {                                                      │
│       "chinese_name": "協調溝通",                          │
│       "system_name": "Interpersonal Communication",        │
│       "min_score": 75                                      │
│     },                                                     │
│     {                                                      │
│       "chinese_name": "積極傾聽",                          │
│       "system_name": "Active Listening",                   │
│       "min_score": 70                                      │
│     }                                                      │
│   ],                                                       │
│   "sql_conditions": [                                      │
│     "(trait_results->>'協調溝通')::int >= 75",             │
│     "(trait_results->>'積極傾聽')::int >= 70"              │
│   ],                                                       │
│   "summary": "尋找具備優秀溝通能力的銷售人員"               │
│ }                                                          │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ 後端處理 - 步驟 2: SQL 查詢資料庫                          │
│                                                            │
│ TalentSearchEngine.search_candidates()                    │
│   ↓                                                        │
│ 生成 SQL:                                                  │
│ SELECT                                                     │
│   ip.id, ip.name, ip.email,                               │
│   itr.trait_results                                        │
│ FROM individual_profile ip                                │
│ LEFT JOIN individual_test_result itr                      │
│   ON ip.id = itr.individual_id                            │
│ WHERE ip.name IS NOT NULL                                 │
│   AND itr.trait_results IS NOT NULL                       │
│   AND (                                                    │
│     (trait_results->>'協調溝通')::int >= 75                │
│     OR                                                     │
│     (trait_results->>'積極傾聽')::int >= 70                │
│   )                                                        │
│ LIMIT 50;                                                 │
│   ↓                                                        │
│ 執行查詢                                                    │
│   ↓                                                        │
│ 返回: 15 位符合條件的候選人                                 │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ 後端處理 - 步驟 3: 計算匹配分數                            │
│                                                            │
│ for candidate in candidates:                              │
│   calculate_match_score()                                 │
│     ↓                                                      │
│   從 trait_results 提取分數:                               │
│   - 協調溝通: 85 分                                        │
│   - 積極傾聽: 78 分                                        │
│     ↓                                                      │
│   計算總分:                                                │
│   total = (85 + 78) / 200 = 0.815 (81.5%)                │
│                                                            │
│ 排序: 按匹配分數從高到低                                    │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ 後端處理 - 步驟 4: 生成推薦理由                            │
│                                                            │
│ for candidate in top_10:                                  │
│   LLMService.generate_match_reason()                      │
│     ↓                                                      │
│   發送到 DeepSeek API:                                     │
│   "用戶需求：我需要一個善於溝通的銷售人員                   │
│    候選人：王小明                                          │
│    協調溝通：85分                                          │
│    積極傾聽：78分                                          │
│    匹配度：81.5%                                           │
│    請生成推薦理由..."                                       │
│     ↓                                                      │
│   LLM 返回:                                                │
│   "王小明在協調溝通方面表現優異（85分），                   │
│    積極傾聽能力良好（78分），非常適合需要                   │
│    頻繁與客戶互動的銷售職位"                                │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ 後端返回結果                                                │
│                                                            │
│ {                                                          │
│   "candidates": [                                          │
│     {                                                      │
│       "id": 1,                                             │
│       "name": "王小明",                                     │
│       "email": "wang@example.com",                        │
│       "match_score": 0.815,                               │
│       "match_reason": "王小明在協調溝通方面..."            │
│     },                                                     │
│     ...                                                    │
│   ],                                                       │
│   "total": 15,                                             │
│   "query_understanding": "尋找具備優秀溝通能力的銷售人員",  │
│   "suggestions": ["嘗試添加更多具體要求"]                  │
│ }                                                          │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ 前端顯示結果                                                │
│                                                            │
│ 1. 隱藏打字指示器                                          │
│                                                            │
│ 2. 顯示系統訊息                                            │
│    "尋找具備優秀溝通能力的銷售人員。                        │
│     找到 15 位候選人，以下是最匹配的結果。"                 │
│                                                            │
│ 3. 顯示候選人卡片                                          │
│    ┌─────────────────────────────────┐                   │
│    │ 👤 王小明                        │                   │
│    │ 📧 wang@example.com             │                   │
│    │ 💯 匹配度: 82%                   │                   │
│    │ 💡 王小明在協調溝通方面表現優異... │                   │
│    └─────────────────────────────────┘                   │
│                                                            │
│ 4. 顯示搜索建議                                            │
│    • 嘗試添加更多具體要求                                  │
│    • 指定職位類型或經驗水平                                │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ ✅ 搜索完成！                                              │
│                                                            │
│ 用戶可以：                                                 │
│ • 點擊候選人卡片查看詳情                                    │
│ • 輸入新的查詢                                             │
│ • 使用搜索建議                                             │
└───────────────────────────────────────────────────────────┘
```

## 🛑 停止流程

```
雙擊 stop_all.bat
        ↓
┌───────────────────────────────────────────────────────────┐
│ 停止後端 API                                               │
│                                                            │
│ 1. 查找後端視窗                                            │
│    taskkill /FI "WINDOWTITLE eq 人才搜索 API*"            │
│                                                            │
│ 2. 終止 Python 進程                                        │
│    taskkill /IM python.exe /F                             │
│                                                            │
│ 3. 關閉 SSH 隧道                                           │
│    ✓ 自動斷開連接                                          │
│                                                            │
│ 4. 關閉資料庫連接                                          │
│    ✓ 自動釋放資源                                          │
└───────────────────────────────────────────────────────────┘
        ↓
┌───────────────────────────────────────────────────────────┐
│ ✅ 系統已停止                                              │
│                                                            │
│ 前端頁面可以手動關閉                                        │
└───────────────────────────────────────────────────────────┘
```

## 📊 系統狀態監控

### 後端日誌

後端視窗會顯示：

```
INFO:     Started server process
INFO:     Waiting for application startup.
正在初始化資料庫連接...
SSH 隧道已建立，本地端口: 12345
資料庫連接成功！
載入 50 個特質
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000
```

### API 請求日誌

每次搜索會顯示：

```
INFO:     127.0.0.1:xxxxx - "POST /api/search HTTP/1.1" 200 OK
LLM 分析查詢...
執行 SQL:
  SELECT * FROM individual_profile ...
找到 15 位候選人
生成推薦理由...
```

### 前端狀態

瀏覽器控制台（F12）會顯示：

```
Vue app mounted
Checking API connection...
API connection: OK
Ready for user input
```

這就是完整的系統啟動和運行流程！🚀
