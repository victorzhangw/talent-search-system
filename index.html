<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI 人才搜索系統</title>

    <!-- External CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <div id="app">
      <!-- 頂部標題 -->
      <div class="header">
        <div class="logo">
          <i class="fas fa-brain"></i>
        </div>
        <div class="header-content">
          <h1>AI 人才搜索系統</h1>
          <p>智能人才匹配與分析平台</p>
        </div>
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span>{{ connectionStatus }}</span>
        </div>
      </div>

      <div class="main-content">
        <!-- 左側聊天區域 -->
        <div class="chat-area">
          <div class="messages" ref="messagesContainer">
            <div
              v-for="message in messages"
              :key="message.id"
              :class="['message', message.type]"
            >
              <div class="message-avatar">
                <i
                  :class="message.type === 'user' ? 'fas fa-user' : 'fas fa-robot'"
                ></i>
              </div>
              <div class="message-content">{{ message.content }}</div>
            </div>

            <div v-if="isTyping" class="message system">
              <div class="message-avatar">
                <i class="fas fa-robot"></i>
              </div>
              <div class="message-content">
                <div class="typing-indicator">
                  <div class="typing-dot"></div>
                  <div class="typing-dot"></div>
                  <div class="typing-dot"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="input-area">
            <div class="input-container">
              <input
                v-model="userInput"
                @keyup.enter="sendMessage"
                placeholder="描述您需要的人才特質或直接提問..."
                :disabled="isTyping"
              />
              <button
                @click="sendMessage"
                :disabled="!userInput.trim() || isTyping"
              >
                <i class="fas fa-paper-plane"></i> 發送
              </button>
            </div>
            <div class="suggestions" v-if="suggestions.length > 0">
              <span
                v-for="(suggestion, index) in suggestions"
                :key="index"
                class="suggestion-chip"
                @click="useSuggestion(suggestion)"
              >
                {{ suggestion }}
              </span>
            </div>
          </div>
        </div>

        <!-- 右側結果區域 -->
        <div class="results-area">
          <div class="results-header">
            <div class="results-title">搜索結果</div>
            <div class="results-count">
              {{ candidates.length > 0 ? `找到 ${candidates.length} 位候選人` :
              '等待搜索...' }}
            </div>
          </div>

          <!-- 功能列 -->
          <div class="action-bar" v-if="candidates.length > 0">
            <div class="action-bar-title">
              已選擇 {{ selectedCandidates.length }} 位候選人
            </div>
            <button
              class="action-btn"
              @click="generateInterviewQuestions"
              :disabled="selectedCandidates.length === 0"
            >
              <i class="fas fa-clipboard-question"></i>
              生成面試問題
            </button>
          </div>

          <div class="results-content">
            <div v-if="candidates.length === 0" class="empty-state">
              <i class="fas fa-search"></i>
              <h3>開始搜索</h3>
              <p>在左側輸入您的需求，<br />我會為您找到合適的人才</p>
            </div>

            <div
              v-for="candidate in candidates"
              :key="candidate.id"
              class="candidate-card"
              :class="{ selected: isSelected(candidate.id) }"
            >
              <!-- Checkbox -->
              <input
                type="checkbox"
                class="candidate-checkbox"
                :checked="isSelected(candidate.id)"
                @click.stop="toggleSelection(candidate)"
              />

              <!-- 卡片內容 -->
              <div
                class="candidate-card-content"
                @click="viewCandidate(candidate)"
              >
                <div class="candidate-header">
                  <div class="candidate-avatar">
                    {{ getInitials(candidate.name) }}
                  </div>
                  <div class="candidate-info">
                    <h3>{{ candidate.name }}</h3>
                    <div class="candidate-email">{{ candidate.email }}</div>
                  </div>
                </div>
                <div class="match-score">
                  <div class="score-bar">
                    <div
                      class="score-fill"
                      :style="{ width: (candidate.match_score * 100) + '%' }"
                    ></div>
                  </div>
                  <div class="score-text">
                    {{ Math.round(candidate.match_score * 100) }}%
                  </div>
                </div>
                <div class="match-reason">
                  <i
                    class="fas fa-lightbulb"
                    style="margin-right: 8px; color: #93bfc7"
                  ></i>
                  <span
                    v-html="formatMatchReason(candidate.match_reason)"
                  ></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 面試問題對話框 -->
        <div
          class="interview-dialog"
          v-if="showInterviewDialog"
          @click.self="closeInterviewDialog"
        >
          <div class="interview-dialog-content">
            <div class="interview-dialog-header">
              <h2>
                <i
                  class="fas fa-clipboard-question"
                  style="margin-right: 8px; color: #93bfc7"
                ></i>
                面試問題建議
              </h2>
              <button class="close-btn" @click="closeInterviewDialog">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="interview-dialog-body">
              <div class="interview-messages">
                <div
                  v-for="(message, index) in interviewMessages"
                  :key="index"
                  class="interview-message"
                  :class="message.role"
                  v-html="formatInterviewMessage(message.content)"
                ></div>
                <div v-if="isGeneratingQuestions" class="loading-indicator">
                  <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                  </div>
                  正在生成面試問題...
                </div>
              </div>
            </div>
            <div class="interview-dialog-footer">
              <div class="interview-footer-actions">
                <button
                  class="download-btn"
                  @click="downloadAsExcel"
                  :disabled="interviewMessages.length === 0"
                >
                  <i class="fas fa-file-excel"></i>
                  下載為 CSV
                </button>
              </div>
              <input
                v-model="interviewInput"
                @keyup.enter="sendInterviewMessage"
                class="interview-input"
                placeholder="輸入您的修改建議，例如：請增加關於團隊合作的問題..."
                :disabled="isGeneratingQuestions"
              />
              <button
                class="send-btn"
                @click="sendInterviewMessage"
                :disabled="!interviewInput.trim() || isGeneratingQuestions"
              >
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- External JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="assets/js/app.js"></script>
  </body>
</html>
