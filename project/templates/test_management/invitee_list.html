{% extends 'base.html' %}
{% load static %}

{% block title %}å—æ¸¬äººå“¡ç®¡ç† - {{ block.super }}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'dashboard' %}">é¦–é </a></li>
<li class="breadcrumb-item"><a href="{% url 'enterprise_dashboard' %}">ä¼æ¥­æ¸¬é©—ç®¡ç†</a></li>
<li class="breadcrumb-item active">å—æ¸¬äººå“¡ç®¡ç†</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-people me-2"></i>å—æ¸¬äººå“¡ç®¡ç†</h2>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addInviteeModal">
            <i class="bi bi-person-plus me-1"></i>æ–°å¢å—æ¸¬äººå“¡
        </button>
    </div>

    <!-- æœå°‹æ¡† -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-8">
                    <input type="text" name="search" class="form-control" 
                           placeholder="æœå°‹å§“åã€ä¿¡ç®±æˆ–è·ä½..." value="{{ search }}">
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-outline-primary me-2">
                        <i class="bi bi-search me-1"></i>æœå°‹
                    </button>
                    <a href="{% url 'invitee_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-clockwise me-1"></i>é‡ç½®
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- å—æ¸¬äººå“¡åˆ—è¡¨ -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                å—æ¸¬äººå“¡åˆ—è¡¨
                <small class="text-muted">ï¼ˆå…± {{ page_obj.paginator.count }} äººï¼‰</small>
            </h5>
            <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-secondary" onclick="selectAll()">
                    <i class="bi bi-check-square me-1"></i>å…¨é¸
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="selectNone()">
                    <i class="bi bi-square me-1"></i>å–æ¶ˆå…¨é¸
                </button>
                <button type="button" class="btn btn-outline-danger" onclick="batchDelete()" disabled id="batchDeleteBtn">
                    <i class="bi bi-trash me-1"></i>æ‰¹é‡åˆªé™¤
                </button>
            </div>
        </div>
        <div class="card-body">
            {% if page_obj.object_list %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th width="40">
                                    <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                                </th>
                                <th>å§“å</th>
                                <th>é›»å­éƒµä»¶</th>
                                <th>è¯çµ¡é›»è©±</th>
                                <th>ç‹€æ…‹</th>
                                <th>è·ä½</th>
                                <th>å—é‚€æ¬¡æ•¸</th>
                                <th>å®Œæˆç‡</th>
                                <th>å»ºç«‹æ™‚é–“</th>
                                <th width="150">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for invitee in page_obj.object_list %}
                            <tr id="invitee-row-{{ invitee.id }}">
                                <td>
                                    <input type="checkbox" class="invitee-checkbox" value="{{ invitee.id }}" onchange="updateBatchDeleteButton()">
                                </td>
                                <td>
                                    <strong>{{ invitee.name }}</strong>
                                    {% if invitee.notes %}
                                    <i class="bi bi-chat-text text-info ms-1" title="{{ invitee.notes }}" data-bs-toggle="tooltip"></i>
                                    {% endif %}
                                </td>
                                <td>{{ invitee.email }}</td>
                                <td>{{ invitee.phone|default:"-" }}</td>
                                <td>
                                    <span class="badge bg-{% if invitee.status == 'employed' %}primary{% else %}secondary{% endif %}">
                                        {{ invitee.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ invitee.position|default:"-" }}</td>
                                <td>
                                    <span class="badge bg-primary">{{ invitee.invited_count }}</span>
                                </td>
                                <td>
                                    {% if invitee.invited_count > 0 %}
                                        <span class="badge bg-{% if invitee.completion_rate >= 80 %}success{% elif invitee.completion_rate >= 60 %}warning{% else %}danger{% endif %}">
                                            {{ invitee.completion_rate }}%
                                        </span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>{{ invitee.created_at|date:"Y/m/d" }}</td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{% url 'edit_invitee' invitee.id %}" class="btn btn-outline-primary" title="ç·¨è¼¯">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <button class="btn btn-outline-danger" onclick="deleteInvitee({{ invitee.id }}, '{{ invitee.name }}')" title="åˆªé™¤">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                        <button class="btn btn-outline-info" onclick="viewInvitations({{ invitee.id }}, '{{ invitee.name }}')" title="æŸ¥çœ‹é‚€è«‹è¨˜éŒ„">
                                            <i class="bi bi-envelope-open"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é  -->
                {% if page_obj.has_other_pages %}
                <nav aria-label="åˆ†é å°èˆª" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}">ä¸Šä¸€é </a>
                        </li>
                        {% endif %}
                        
                        {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% if search %}&search={{ search }}{% endif %}">{{ num }}</a>
                        </li>
                        {% endif %}
                        {% endfor %}
                        
                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}">ä¸‹ä¸€é </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-people text-muted" style="font-size: 3rem;"></i>
                    <h5 class="mt-3 text-muted">å°šæœªæ–°å¢å—æ¸¬äººå“¡</h5>
                    <p class="text-muted">æ–°å¢å—æ¸¬äººå“¡ä¾†é–‹å§‹ç™¼é€æ¸¬é©—é‚€è«‹</p>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addInviteeModal">
                        <i class="bi bi-person-plus me-1"></i>æ–°å¢ç¬¬ä¸€ä½å—æ¸¬äººå“¡
                    </button>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- æ–°å¢å—æ¸¬äººå“¡ Modal -->
<div class="modal fade" id="addInviteeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-person-plus me-2"></i>æ–°å¢å—æ¸¬äººå“¡
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="addInviteeForm">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">
                                    å§“å <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       placeholder="è«‹è¼¸å…¥å§“å" maxlength="50" required>
                                <div class="invalid-feedback"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="email" class="form-label">
                                    é›»å­éƒµä»¶ <span class="text-danger">*</span>
                                </label>
                                <input type="email" class="form-control" id="email" name="email" 
                                       placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" required>
                                <div class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="phone" class="form-label">è¯çµ¡é›»è©±</label>
                                <input type="text" class="form-control" id="phone" name="phone" 
                                       placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±ï¼ˆé¸å¡«ï¼‰" maxlength="20">
                                <div class="invalid-feedback"></div>
                                <div class="form-text">æ”¯æ´å°ç£æ‰‹æ©Ÿå’Œå¸‚è©±æ ¼å¼</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="status" class="form-label">ç‹€æ…‹</label>
                                <select class="form-control" id="status" name="status">
                                    <option value="employed">åœ¨è·</option>
                                    <option value="job_seeker">æ±‚è·è€…</option>
                                </select>
                                <div class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="position" class="form-label">è·ä½</label>
                                <input type="text" class="form-control" id="position" name="position" 
                                       placeholder="è«‹è¼¸å…¥è·ä½ï¼ˆé¸å¡«ï¼‰" maxlength="50">
                                <div class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">å‚™è¨»</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3" 
                                  placeholder="å‚™è¨»ï¼ˆé¸å¡«ï¼‰" maxlength="500"></textarea>
                        <div class="invalid-feedback"></div>
                        <div class="form-text">
                            <span id="notesCount">0</span>/500 å­—
                        </div>
                    </div>
                    
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="continueAdd">
                        <label class="form-check-label" for="continueAdd">
                            æ–°å¢å®Œç¹¼çºŒæ–°å¢ä¸‹ä¸€ä½
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check me-1"></i>ç¢ºå®šæ–°å¢
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- æ‰¹é‡åˆªé™¤ç¢ºèª Modal -->
<div class="modal fade" id="batchDeleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>æ‰¹é‡åˆªé™¤ç¢ºèª
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>æ‚¨ç¢ºå®šè¦åˆªé™¤é¸ä¸­çš„ <span id="deleteCount" class="fw-bold text-danger"></span> ä½å—æ¸¬äººå“¡å—ï¼Ÿ</p>
                <p class="text-muted small">æ³¨æ„ï¼šæœ‰æ¸¬é©—é‚€è«‹è¨˜éŒ„çš„å—æ¸¬äººå“¡å°‡ç„¡æ³•åˆªé™¤</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-danger" onclick="confirmBatchDelete()">
                    <i class="bi bi-trash me-1"></i>ç¢ºå®šåˆªé™¤
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// åˆå§‹åŒ– tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // å‚™è¨»å­—æ•¸çµ±è¨ˆ
    const notesTextarea = document.getElementById('notes');
    const notesCount = document.getElementById('notesCount');
    
    notesTextarea.addEventListener('input', function() {
        notesCount.textContent = this.value.length;
    });
});

// æ–°å¢å—æ¸¬äººå“¡è¡¨å–®æäº¤
document.getElementById('addInviteeForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // é˜²æ­¢é‡è¤‡æäº¤
    const submitBtn = this.querySelector('button[type="submit"]');
    if (submitBtn.disabled) {
        return; // å¦‚æœæŒ‰éˆ•å·²è¢«ç¦ç”¨ï¼Œç›´æ¥è¿”å›
    }
    
    // ç¦ç”¨æäº¤æŒ‰éˆ•
    submitBtn.disabled = true;
    const originalText = submitBtn.innerHTML;
    submitBtn.setAttribute('data-original-text', originalText);
    submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> è™•ç†ä¸­...';
    
    const formData = new FormData(this);
    
    // æ¸…é™¤ä¹‹å‰çš„éŒ¯èª¤ç‹€æ…‹
    clearFormErrors();
    
    // é¡¯ç¤º loadingï¼ˆå¦‚æœå‡½æ•¸å­˜åœ¨ï¼‰
    if (typeof window.showLoading === 'function') {
        window.showLoading('æ­£åœ¨æ–°å¢å—æ¸¬äººå“¡...', 'è«‹ç¨å€™ï¼Œç³»çµ±æ­£åœ¨è™•ç†æ‚¨çš„è«‹æ±‚');
    }
    
    fetch('{% url "create_invitee" %}', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // éš±è— loading ä¸¦é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            if (typeof window.hideLoading === 'function') {
                window.hideLoading();
            }
            
            // æˆåŠŸæç¤º
            showAlert('success', data.message);
            
            // æª¢æŸ¥æ˜¯å¦ç¹¼çºŒæ–°å¢
            const continueAdd = document.getElementById('continueAdd').checked;
            
            if (continueAdd) {
                // æ¸…ç©ºè¡¨å–®ï¼Œä¿æŒ modal é–‹å•Ÿ
                this.reset();
                const notesCount = document.getElementById('notesCount');
                if (notesCount) notesCount.textContent = '0';
                document.getElementById('name').focus();
                
                // éš±è— loading
                if (typeof window.hideLoading === 'function') {
                    window.hideLoading();
                }
            } else {
                // å»¶é²é—œé–‰ modal ä¸¦åˆ·æ–°é é¢
                setTimeout(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addInviteeModal'));
                    if (modal) modal.hide();
                    window.location.reload();
                }, 1500);
            }
        } else {
            // éš±è— loading
            if (typeof window.hideLoading === 'function') {
                window.hideLoading();
            }
            
            // é¡¯ç¤ºè¡¨å–®éŒ¯èª¤
            if (data.errors) {
                showFormErrors(data.errors);
            } else {
                showAlert('danger', data.message || 'æ–°å¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }
    })
    .catch(error => {
        console.error('æ–°å¢å—æ¸¬äººå“¡éŒ¯èª¤:', error);
        
        // éš±è— loadingï¼ˆå¦‚æœå‡½æ•¸å­˜åœ¨ï¼‰
        if (typeof window.hideLoading === 'function') {
            window.hideLoading();
        }
        
        // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯
        let errorMessage = 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦';
        if (error.name === 'TypeError') {
            errorMessage = 'è«‹æ±‚è™•ç†å‡ºç¾å•é¡Œï¼Œè«‹é‡æ–°æ•´ç†é é¢å¾Œå†è©¦';
        } else if (error.message) {
            errorMessage = `éŒ¯èª¤ï¼š${error.message}`;
        }
        
        showAlert('danger', errorMessage);
    })
    .finally(() => {
        // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
        const submitBtn = this.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.disabled = false;
            const originalText = submitBtn.getAttribute('data-original-text');
            if (originalText) {
                submitBtn.innerHTML = originalText;
                submitBtn.removeAttribute('data-original-text');
            }
        }
    });
    
    // ğŸ”§ åŠ å…¥è¶…æ™‚ä¿è­·
    setTimeout(() => {
        // æª¢æŸ¥æ˜¯å¦é‚„åœ¨ loading ç‹€æ…‹
        const loadingElement = document.querySelector('.loading-overlay');
        if (loadingElement && !loadingElement.classList.contains('d-none')) {
            console.warn('æ–°å¢å—æ¸¬äººå“¡è¶…æ™‚ï¼Œå¼·åˆ¶éš±è— loading');
            if (typeof window.hideLoading === 'function') {
                window.hideLoading();
            }
            showAlert('warning', 'æ“ä½œè¶…æ™‚ï¼Œè«‹é‡è©¦');
        }
    }, 10000); // 10ç§’è¶…æ™‚
});

// é¡¯ç¤ºè¡¨å–®éŒ¯èª¤
function showFormErrors(errors) {
    for (const [field, messages] of Object.entries(errors)) {
        const input = document.getElementById(field);
        if (input) {
            input.classList.add('is-invalid');
            const feedback = input.nextElementSibling;
            if (feedback && feedback.classList.contains('invalid-feedback')) {
                feedback.textContent = messages.join(', ');
            }
        }
    }
}

// æ¸…é™¤è¡¨å–®éŒ¯èª¤
function clearFormErrors() {
    document.querySelectorAll('.is-invalid').forEach(el => {
        el.classList.remove('is-invalid');
    });
}

// é¡¯ç¤ºæç¤ºè¨Šæ¯
function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // è‡ªå‹•ç§»é™¤
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// åˆªé™¤å–®å€‹å—æ¸¬äººå“¡
function deleteInvitee(inviteeId, inviteeName) {
    if (confirm(`ç¢ºå®šè¦åˆªé™¤å—æ¸¬äººå“¡ã€Œ${inviteeName}ã€å—ï¼Ÿ`)) {
        // é¡¯ç¤ºåˆªé™¤ loading
        window.showLoading('æ­£åœ¨åˆªé™¤å—æ¸¬äººå“¡...', 'è«‹ç¨å€™ï¼Œç³»çµ±æ­£åœ¨è™•ç†åˆªé™¤è«‹æ±‚');
        
        fetch(`/enterprise/invitees/${inviteeId}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                showAlert('success', data.message);
                
                // å»¶é²ç§»é™¤è©²è¡Œ
                setTimeout(() => {
                    document.getElementById(`invitee-row-${inviteeId}`).remove();
                    updateBatchDeleteButton();
                    if (typeof window.hideLoading === 'function') {
                        window.hideLoading();
                    }
                }, 1000);
            } else {
                if (typeof window.hideLoading === 'function') {
                    window.hideLoading();
                }
                showAlert('danger', data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            if (typeof window.hideLoading === 'function') {
                window.hideLoading();
            }
            showAlert('danger', 'åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
        });
    }
}

// æŸ¥çœ‹é‚€è«‹è¨˜éŒ„
function viewInvitations(inviteeId, inviteeName) {
    // è·³è½‰åˆ°é‚€è«‹åˆ—è¡¨é é¢ï¼Œä¸¦ç¯©é¸è©²å—æ¸¬äººå“¡
    window.location.href = `{% url 'invitation_list' %}?invitee=${inviteeId}`;
}

// å…¨é¸/å–æ¶ˆå…¨é¸åŠŸèƒ½
function toggleSelectAll() {
    const selectAllCheckbox = document.getElementById('selectAllCheckbox');
    const checkboxes = document.querySelectorAll('.invitee-checkbox');
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;
    });
    
    updateBatchDeleteButton();
}

function selectAll() {
    document.getElementById('selectAllCheckbox').checked = true;
    toggleSelectAll();
}

function selectNone() {
    document.getElementById('selectAllCheckbox').checked = false;
    toggleSelectAll();
}

// æ›´æ–°æ‰¹é‡åˆªé™¤æŒ‰éˆ•ç‹€æ…‹
function updateBatchDeleteButton() {
    const checkedBoxes = document.querySelectorAll('.invitee-checkbox:checked');
    const batchDeleteBtn = document.getElementById('batchDeleteBtn');
    
    if (checkedBoxes.length > 0) {
        batchDeleteBtn.disabled = false;
        batchDeleteBtn.innerHTML = `<i class="bi bi-trash me-1"></i>æ‰¹é‡åˆªé™¤ (${checkedBoxes.length})`;
    } else {
        batchDeleteBtn.disabled = true;
        batchDeleteBtn.innerHTML = '<i class="bi bi-trash me-1"></i>æ‰¹é‡åˆªé™¤';
    }
}

// æ‰¹é‡åˆªé™¤
function batchDelete() {
    const checkedBoxes = document.querySelectorAll('.invitee-checkbox:checked');
    if (checkedBoxes.length === 0) return;
    
    document.getElementById('deleteCount').textContent = checkedBoxes.length;
    new bootstrap.Modal(document.getElementById('batchDeleteModal')).show();
}

function confirmBatchDelete() {
    const checkedBoxes = document.querySelectorAll('.invitee-checkbox:checked');
    const inviteeIds = Array.from(checkedBoxes).map(cb => cb.value);
    
    // é€™è£¡éœ€è¦å¯¦ä½œæ‰¹é‡åˆªé™¤çš„å¾Œç«¯ API
    showAlert('info', 'æ‰¹é‡åˆªé™¤åŠŸèƒ½é–‹ç™¼ä¸­...');
    bootstrap.Modal.getInstance(document.getElementById('batchDeleteModal')).hide();
}

// Modal é‡ç½®åŠŸèƒ½
document.getElementById('addInviteeModal').addEventListener('hidden.bs.modal', function() {
    document.getElementById('addInviteeForm').reset();
    document.getElementById('notesCount').textContent = '0';
    clearFormErrors();
});
</script>
{% endblock %}