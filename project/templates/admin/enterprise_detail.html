{% extends 'base.html' %}
{% load static %}

{% block title %}企業詳細資訊{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'dashboard' %}">儀表板</a></li>
<li class="breadcrumb-item"><a href="{% url 'enterprise_approval_list' %}">企業審核</a></li>
<li class="breadcrumb-item active">企業詳細資訊</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-building me-2"></i>{{ enterprise_profile.company_name }}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>基本資訊</h6>
                            <table class="table table-borderless">
                                <tr>
                                    <th width="120">公司名稱：</th>
                                    <td>{{ enterprise_profile.company_name }}</td>
                                </tr>
                                <tr>
                                    <th>統一編號：</th>
                                    <td>{{ enterprise_profile.tax_id }}</td>
                                </tr>
                                <tr>
                                    <th>聯絡人：</th>
                                    <td>{{ enterprise_profile.contact_person }}</td>
                                </tr>
                                <tr>
                                    <th>聯絡電話：</th>
                                    <td>{{ enterprise_profile.contact_phone }}</td>
                                </tr>
                                <tr>
                                    <th>電子郵件：</th>
                                    <td>{{ user.email }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>狀態資訊</h6>
                            <table class="table table-borderless">
                                <tr>
                                    <th width="120">審核狀態：</th>
                                    <td>
                                        {% if enterprise_profile.verification_status == 'pending' %}
                                            <span class="badge bg-warning">待審核</span>
                                        {% elif enterprise_profile.verification_status == 'approved' %}
                                            <span class="badge bg-success">已核准</span>
                                        {% else %}
                                            <span class="badge bg-danger">已拒絕</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Email驗證：</th>
                                    <td>
                                        {% if user.is_email_verified %}
                                            <span class="badge bg-success">已驗證</span>
                                        {% else %}
                                            <span class="badge bg-warning">未驗證</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>帳號狀態：</th>
                                    <td>
                                        {% if user.is_active %}
                                            <span class="badge bg-success">已啟用</span>
                                        {% else %}
                                            <span class="badge bg-secondary">未啟用</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>註冊時間：</th>
                                    <td>{{ user.created_at|date:"Y-m-d H:i:s" }}</td>
                                </tr>
                                {% if enterprise_profile.verified_at %}
                                <tr>
                                    <th>審核時間：</th>
                                    <td>{{ enterprise_profile.verified_at|date:"Y-m-d H:i:s" }}</td>
                                </tr>
                                {% endif %}
                            </table>
                        </div>
                    </div>
                    
                    {% if enterprise_profile.address %}
                    <div class="mt-3">
                        <h6>公司地址</h6>
                        <p>{{ enterprise_profile.address }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            {% if enterprise_profile.verification_status == 'pending' %}
            <div class="card">
                <div class="card-header">
                    <h6>審核操作</h6>
                </div>
                <div class="card-body">
                    <form method="post" action="{% url 'approve_enterprise' user.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success w-100 mb-2" 
                                onclick="return confirm('確定要核准此企業嗎？')">
                            <i class="bi bi-check-circle me-2"></i>核准企業
                        </button>
                    </form>
                    
                    <button type="button" class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#rejectModal">
                        <i class="bi bi-x-circle me-2"></i>拒絕企業
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- 拒絕理由 Modal -->
<div class="modal fade" id="rejectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">拒絕企業申請</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'reject_enterprise' user.id %}">
                {% csrf_token %}
                <div class="modal-body">
                    <p>您即將拒絕企業：<strong>{{ enterprise_profile.company_name }}</strong></p>
                    <div class="mb-3">
                        <label for="rejection_reason" class="form-label">拒絕理由</label>
                        <textarea class="form-control" id="rejection_reason" name="rejection_reason" 
                                  rows="3" placeholder="請輸入拒絕理由..." required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="submit" class="btn btn-danger">確認拒絕</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}