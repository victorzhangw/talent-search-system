# 個人使用者功能說明文檔

## 📋 專案概述

Django CPDS 個人使用者功能模組，提供個人用戶完整的測驗購買、參與、結果查看等功能。

**最後更新**: 2025-07-16  
**版本**: 1.0  
**開發狀態**: 核心功能已完成，PDF報告功能待開發

---

## 🎯 功能架構

### 用戶類型定義
- **個人用戶**: 獨立註冊的用戶，可自主購買和參與測驗
- **企業用戶**: 企業HR，可邀請員工或候選人參與測驗
- **被邀請者**: 由企業邀請的測驗參與者（不屬於個人用戶範疇）

### 個人用戶完整流程
```
註冊登入 → 瀏覽測驗 → 購買測驗 → 參與測驗 → 查看結果 → 下載報告
```

---

## ✅ 已實現功能

### 1. 用戶註冊與認證系統
- **個人用戶註冊**: `/register/individual/`
- **郵件驗證**: 註冊後需驗證郵箱
- **登入系統**: 支援用戶名/郵箱登入
- **密碼重設**: 忘記密碼功能
- **個人資料管理**: 查看和編輯個人資料

### 2. 點數系統
- **初始點數**: 個人用戶註冊後獲得100點
- **點數查看**: 即時顯示當前點數餘額
- **點數購買**: 支援線上購買點數
- **消費記錄**: 完整的點數交易歷史
- **測驗費用**: 每個測驗消費1點數

### 3. 測驗購買系統 ⭐
**位置**: `/individual-tests/`

#### 功能特色:
- **卡片式展示**: 每個測驗項目以卡片形式呈現
- **智能狀態**: 區分未購買/已購買測驗
- **點數驗證**: 自動檢查點數是否足夠
- **購買確認**: 詳細的購買確認頁面

#### 測驗卡片資訊:
- 測驗名稱和描述
- 測驗簡介
- 費用顯示 (1點)
- 建立時間
- 購買/進入按鈕

#### 購買流程:
1. **瀏覽測驗** → 顯示所有可用測驗
2. **點擊購買** → 跳轉確認頁面
3. **確認購買** → 顯示點數扣除資訊
4. **扣除點數** → 自動扣除1點
5. **跳轉測驗** → 直接進入外部測驗平台

### 4. 測驗記錄追蹤 ⭐
**模型**: `IndividualTestRecord`

#### 追蹤資訊:
- 購買時間
- 首次/最後進入時間
- 進入次數統計
- 測驗狀態 (已購買/進行中/已完成)
- 消費點數記錄

#### 功能特色:
- **防重複購買**: 每個測驗只能購買一次
- **重複進入**: 已購買測驗可重複進入
- **狀態追蹤**: 自動更新測驗狀態
- **統計分析**: 進入次數和時間統計

### 5. 測驗結果儲存系統 ⭐
**模型**: `IndividualTestResult`

#### 數據結構:
```python
{
    "score_value": 2.96,                    # 整體評分
    "category_results": {                   # 分類結果
        "領導力": {"score": 3.4, "description": "..."},
        "溝通協調": {"score": 2.4, "description": "..."},
        "創新思維": {"score": 2.1, "description": "..."},
        "抗壓能力": {"score": 2.6, "description": "..."},
        "學習適應": {"score": 4.3, "description": "..."}
    },
    "trait_results": {                      # 特質結果
        "外向性": 4.9,
        "親和性": 2.5,
        "責任心": 4.0,
        "情緒穩定性": 4.2,
        "開放性": 4.0
    },
    "raw_data": {...},                      # 原始測驗數據
    "processed_data": {...}                 # 處理後數據
}
```

#### 分析功能:
- **分類分析**: 5個能力分類的評分和描述
- **特質分析**: 5個人格特質的評分
- **優勢劣勢**: 自動識別最強/最弱領域
- **等級評估**: 分數轉換為等級描述
- **百分比計算**: 分數轉換為百分比顯示

### 6. 測驗結果查看介面 ⭐
**位置**: `/my-test-results/<result_id>/`

#### 介面特色:
- **響應式設計**: 支援桌面和移動設備
- **視覺化圖表**: 使用Chart.js繪製雷達圖
- **分類展示**: 圓形進度圖顯示各分類評分
- **特質條形圖**: 動態條形圖展示特質評分
- **優勢劣勢**: 清晰的優勢/劣勢分析

#### 頁面內容:
1. **結果概覽**: 整體評分和完成時間
2. **分類分析**: 5個分類的詳細評分
3. **能力雷達圖**: 互動式雷達圖
4. **特質分析**: 5個特質的條形圖
5. **分析洞察**: 優勢和發展領域
6. **詳細報告**: 文字版分析報告

### 7. 導航和用戶體驗
- **側邊欄導航**: 清晰的功能分類
- **麵包屑導航**: 顯示當前位置
- **狀態指示**: 即時顯示點數和狀態
- **按鈕狀態**: 智能顯示可用/不可用操作
- **訊息提示**: 操作成功/失敗的即時反饋

---

## 🛠️ 技術實現

### 核心模型
```python
# 個人測驗記錄
class IndividualTestRecord(models.Model):
    user = models.ForeignKey(User, ...)
    test_project = models.ForeignKey(TestProject, ...)
    status = models.CharField(...)          # 測驗狀態
    purchase_date = models.DateTimeField()  # 購買時間
    access_count = models.IntegerField()    # 進入次數
    points_consumed = models.IntegerField() # 消費點數

# 個人測驗結果
class IndividualTestResult(models.Model):
    individual_test_record = models.OneToOneField(IndividualTestRecord, ...)
    score_value = models.FloatField()       # 整體評分
    category_results = models.JSONField()   # 分類結果
    trait_results = models.JSONField()      # 特質結果
    result_status = models.CharField()      # 結果狀態
    test_completion_date = models.DateTimeField()  # 完成時間
```

### 關鍵視圖
```python
# 測驗列表和購買
def individual_tests(request)              # 測驗列表頁面
def test_purchase_confirm(request, project_id)  # 購買確認
def test_purchase_process(request, project_id)  # 處理購買
def direct_test_access(request, project_id)     # 直接進入測驗

# 結果查看
def individual_test_result_detail(request, result_id)  # 結果詳情
def individual_test_results_list(request)              # 結果列表
```

### URL 路由
```python
# 測驗功能
path('individual-tests/', individual_tests, name='individual_tests'),
path('individual-tests/<int:project_id>/confirm/', test_purchase_confirm, name='test_purchase_confirm'),
path('individual-tests/<int:project_id>/purchase/', test_purchase_process, name='test_purchase_process'),
path('individual-tests/<int:project_id>/access/', direct_test_access, name='direct_test_access'),

# 結果查看
path('my-test-results/', individual_test_results_list, name='individual_test_results_list'),
path('my-test-results/<int:result_id>/', individual_test_result_detail, name='individual_test_result_detail'),
```

### 前端技術
- **Bootstrap 5**: 響應式UI框架
- **Chart.js**: 圖表繪製
- **Bootstrap Icons**: 圖標系統
- **自定義CSS**: 卡片動畫和視覺效果

---

## 📊 資料庫結構

### 測驗項目權限
```python
ASSIGNMENT_TYPE_CHOICES = [
    ('all_open', '全部開放'),
    ('enterprise_only', '僅開放給企業'),
    ('individual_only', '僅開放給個人'),
    ('specific_assignment', '指定開放'),
]
```

### 結果狀態
```python
RESULT_STATUS_CHOICES = [
    ('pending', '等待結果'),
    ('manual_input', '手動輸入'),
    ('auto_crawled', '自動爬取'),
    ('completed', '結果完整'),
    ('failed', '獲取失敗'),
]
```

### 索引優化
- 用戶和測驗項目的複合索引
- 結果狀態索引
- 創建時間索引

---

## 🔍 測試數據

### 自動生成測試數據
```bash
# 創建測試數據命令
python manage.py create_individual_test_data --with-results
```

### 測試數據內容
- **用戶**: i_obo (個人用戶)
- **測驗項目**: 銷售預測模型
- **整體評分**: 2.96/5.0
- **分類結果**: 5個分類的完整評分
- **特質結果**: 5個特質的完整評分
- **分析報告**: 自動生成的預測描述

---

## 🎯 使用流程

### 管理員操作
1. **創建測驗項目**: 在管理後台創建測驗
2. **設定權限**: 選擇"全部開放"或"僅開放給個人"
3. **輸入測驗結果**: 手動輸入或等待自動爬取

### 個人用戶操作
1. **註冊驗證**: 註冊個人帳號並驗證郵箱
2. **瀏覽測驗**: 進入"我的測驗"頁面
3. **購買測驗**: 選擇測驗並確認購買
4. **參與測驗**: 跳轉到外部測驗平台
5. **查看結果**: 返回查看詳細測驗結果

---

## ⚠️ 目前限制

### 已知問題
1. **真實數據輸入**: 目前只有測試數據，需要實現真實數據的輸入機制
2. **自動結果爬取**: 尚未實現從外部平台自動獲取測驗結果
3. **PDF報告生成**: 個人版PDF報告功能尚未實現
4. **結果列表頁**: 個人測驗結果列表頁面尚未完成

### 待開發功能
1. **PDF報告系統**: 個人版測驗報告生成
2. **結果輸入介面**: 供用戶手動輸入測驗結果
3. **爬蟲整合**: 自動從測驗平台獲取結果
4. **分享功能**: 測驗結果分享給他人
5. **歷史統計**: 個人測驗歷史和成長追蹤

---

## 🚀 部署說明

### 環境要求
- Python 3.8+
- Django 5.1
- SQLite/PostgreSQL
- Bootstrap 5
- Chart.js

### 安裝步驟
```bash
# 1. 執行資料庫遷移
python manage.py makemigrations
python manage.py migrate

# 2. 創建測試數據
python manage.py create_individual_test_data --with-results

# 3. 啟動服務
python manage.py runserver
```

### 管理後台
- 訪問 `/admin/` 可管理所有個人測驗記錄和結果
- 支援搜尋、篩選和批量操作

---

## 📞 開發備註

### 重要檔案
- **模型**: `core/models.py` (IndividualTestRecord, IndividualTestResult)
- **視圖**: `core/individual_test_views.py`
- **模板**: `templates/individual_tests/`
- **URL**: `core/urls.py`
- **管理**: `core/admin.py`

### 開發者提醒
1. 所有個人測驗功能都需要 `@login_required` 裝飾器
2. 需要檢查 `user.user_type == 'individual'`
3. 點數系統與 `utils.point_service` 整合
4. JSON 欄位用於儲存複雜的測驗結果數據
5. 前端使用 Bootstrap 5 和 Chart.js

### 擴展建議
1. **API 整合**: 提供 REST API 供移動應用使用
2. **多語言支援**: 支援英文和其他語言
3. **進階分析**: 添加更多統計分析功能
4. **社交功能**: 測驗結果分享和比較
5. **個人化**: 根據測驗結果推薦相關內容

---

**文檔結束** - 如有問題請聯繫開發團隊