<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å‰ç«¯åŠŸèƒ½æ¸¬è©¦</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }

      .test-section {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #2c3e36;
        margin-bottom: 10px;
      }

      h2 {
        color: #6fa894;
        margin-bottom: 16px;
        font-size: 18px;
      }

      .test-item {
        padding: 12px;
        margin-bottom: 12px;
        border-left: 4px solid #ddd;
        background: #f8f9fa;
        border-radius: 4px;
      }

      .test-item.pass {
        border-left-color: #28a745;
        background: #d4edda;
      }

      .test-item.fail {
        border-left-color: #dc3545;
        background: #f8d7da;
      }

      .code {
        background: #f4f4f4;
        padding: 8px 12px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        margin: 8px 0;
      }

      button {
        background: linear-gradient(135deg, #6fa894, #89c4ad);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 10px;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(111, 168, 148, 0.3);
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª å‰ç«¯åŠŸèƒ½æ¸¬è©¦</h1>
    <p style="color: #666; margin-bottom: 30px">é©—è­‰æœ€æ–°çš„å‰ç«¯æ”¹é€²</p>

    <div class="test-section">
      <h2>1ï¸âƒ£ ç’°å¢ƒæª¢æ¸¬æ¸¬è©¦</h2>
      <div id="env-test"></div>
      <button onclick="testEnvironmentDetection()">é‹è¡Œæ¸¬è©¦</button>
    </div>

    <div class="test-section">
      <h2>2ï¸âƒ£ API URL é…ç½®æ¸¬è©¦</h2>
      <div id="api-test"></div>
      <button onclick="testApiUrlConfig()">é‹è¡Œæ¸¬è©¦</button>
    </div>

    <div class="test-section">
      <h2>3ï¸âƒ£ é‡æ–°é–‹å§‹åŠŸèƒ½æ¸¬è©¦</h2>
      <div id="restart-test"></div>
      <p style="color: #666; font-size: 13px; margin-top: 12px">
        âš ï¸ æ­¤æ¸¬è©¦éœ€è¦åœ¨å¯¦éš›çš„ talent-chat-frontend.html é é¢ä¸­æ‰‹å‹•é©—è­‰
      </p>
      <button onclick="openMainPage()">æ‰“é–‹ä¸»é é¢</button>
    </div>

    <div class="test-section">
      <h2>4ï¸âƒ£ æŒ‰éˆ•æ¨£å¼æ¸¬è©¦</h2>
      <div id="style-test"></div>
      <div style="margin-top: 16px">
        <button style="background: linear-gradient(135deg, #6fa894, #89c4ad)">
          <i class="fas fa-paper-plane"></i> ç™¼é€æŒ‰éˆ•æ¨£å¼
        </button>
        <button style="background: linear-gradient(135deg, #f59e0b, #f97316)">
          <i class="fas fa-redo"></i> é‡æ–°é–‹å§‹æŒ‰éˆ•æ¨£å¼
        </button>
      </div>
    </div>

    <script>
      function addTestResult(containerId, message, pass) {
        const container = document.getElementById(containerId);
        const item = document.createElement("div");
        item.className = `test-item ${pass ? "pass" : "fail"}`;
        item.innerHTML = `${pass ? "âœ…" : "âŒ"} ${message}`;
        container.appendChild(item);
      }

      function testEnvironmentDetection() {
        const container = document.getElementById("env-test");
        container.innerHTML = "";

        // æ¸¬è©¦ç•¶å‰ç’°å¢ƒ
        const hostname = window.location.hostname;
        addTestResult(
          "env-test",
          `ç•¶å‰ä¸»æ©Ÿå: <span class="code">${hostname}</span>`,
          true
        );

        // æ¸¬è©¦ç’°å¢ƒæª¢æ¸¬é‚è¼¯
        const testCases = [
          { hostname: "localhost", expected: "http://localhost:8000" },
          { hostname: "127.0.0.1", expected: "http://localhost:8000" },
          {
            hostname: "app.onrender.com",
            expected: "https://talent-search-api.onrender.com",
          },
          {
            hostname: "app.vercel.app",
            expected: "https://talent-search-api.onrender.com",
          },
          {
            hostname: "app.netlify.app",
            expected: "https://talent-search-api.onrender.com",
          },
        ];

        testCases.forEach((test) => {
          let apiUrl = "http://localhost:8000";

          if (
            test.hostname.includes("render.com") ||
            test.hostname.includes("onrender.com")
          ) {
            apiUrl = "https://talent-search-api.onrender.com";
          } else if (test.hostname.includes("vercel.app")) {
            apiUrl = "https://talent-search-api.onrender.com";
          } else if (test.hostname.includes("netlify.app")) {
            apiUrl = "https://talent-search-api.onrender.com";
          }

          const pass = apiUrl === test.expected;
          addTestResult(
            "env-test",
            `${test.hostname} â†’ <span class="code">${apiUrl}</span>`,
            pass
          );
        });
      }

      function testApiUrlConfig() {
        const container = document.getElementById("api-test");
        container.innerHTML = "";

        // æ¸¬è©¦ API URL é…ç½®
        const hostname = window.location.hostname;
        let apiBaseUrl = "http://localhost:8000";

        if (
          hostname.includes("render.com") ||
          hostname.includes("onrender.com")
        ) {
          apiBaseUrl = "https://talent-search-api.onrender.com";
        } else if (hostname.includes("vercel.app")) {
          apiBaseUrl = "https://talent-search-api.onrender.com";
        } else if (hostname.includes("netlify.app")) {
          apiBaseUrl = "https://talent-search-api.onrender.com";
        }

        addTestResult(
          "api-test",
          `æª¢æ¸¬åˆ°çš„ API URL: <span class="code">${apiBaseUrl}</span>`,
          true
        );

        // æ¸¬è©¦ API ç«¯é»
        const endpoints = [
          "/health",
          "/api/search",
          "/api/candidates",
          "/api/traits",
        ];

        endpoints.forEach((endpoint) => {
          addTestResult(
            "api-test",
            `ç«¯é»: <span class="code">${apiBaseUrl}${endpoint}</span>`,
            true
          );
        });
      }

      function openMainPage() {
        const container = document.getElementById("restart-test");
        container.innerHTML = "";

        addTestResult("restart-test", "è«‹åœ¨ä¸»é é¢ä¸­æ¸¬è©¦ä»¥ä¸‹åŠŸèƒ½:", true);
        addTestResult("restart-test", "1. ç™¼é€å¹¾æ¢æœç´¢æ¶ˆæ¯", true);
        addTestResult("restart-test", "2. é»æ“Šã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ•", true);
        addTestResult("restart-test", "3. ç¢ºèªå°è©±æ¡†å‡ºç¾", true);
        addTestResult("restart-test", "4. ç¢ºèªå¾Œæª¢æŸ¥ç‹€æ…‹æ˜¯å¦é‡ç½®", true);

        // å˜—è©¦æ‰“é–‹ä¸»é é¢
        window.open("talent-chat-frontend.html", "_blank");
      }

      // è‡ªå‹•é‹è¡Œç’°å¢ƒæª¢æ¸¬æ¸¬è©¦
      window.onload = function () {
        testEnvironmentDetection();
        testApiUrlConfig();

        const container = document.getElementById("style-test");
        addTestResult(
          "style-test",
          "ç™¼é€æŒ‰éˆ•: ç¶ è‰²æ¼¸è®Š (#6fa894 â†’ #89c4ad)",
          true
        );
        addTestResult(
          "style-test",
          "é‡æ–°é–‹å§‹æŒ‰éˆ•: æ©™è‰²æ¼¸è®Š (#f59e0b â†’ #f97316)",
          true
        );
        addTestResult("style-test", "å…©å€‹æŒ‰éˆ•å¤§å°å’Œåœ“è§’ä¸€è‡´", true);
      };
    </script>
  </body>
</html>
